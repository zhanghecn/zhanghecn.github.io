<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>asm运算符和指令 | ASM</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="ASM教程">
    
    <link rel="preload" href="/asm/dist/assets/css/0.styles.bcf31e2a.css" as="style"><link rel="preload" href="/asm/dist/assets/js/app.6634fcdc.js" as="script"><link rel="preload" href="/asm/dist/assets/js/2.c8a9966a.js" as="script"><link rel="preload" href="/asm/dist/assets/js/15.55afd9f3.js" as="script"><link rel="prefetch" href="/asm/dist/assets/js/10.bcf60c5c.js"><link rel="prefetch" href="/asm/dist/assets/js/11.548c431c.js"><link rel="prefetch" href="/asm/dist/assets/js/12.1e9ff982.js"><link rel="prefetch" href="/asm/dist/assets/js/13.cee08286.js"><link rel="prefetch" href="/asm/dist/assets/js/14.0c34b073.js"><link rel="prefetch" href="/asm/dist/assets/js/16.5fc6bad5.js"><link rel="prefetch" href="/asm/dist/assets/js/17.70286e2b.js"><link rel="prefetch" href="/asm/dist/assets/js/18.8ef81a29.js"><link rel="prefetch" href="/asm/dist/assets/js/19.3afd398b.js"><link rel="prefetch" href="/asm/dist/assets/js/20.5d3c78e4.js"><link rel="prefetch" href="/asm/dist/assets/js/21.f610ef5f.js"><link rel="prefetch" href="/asm/dist/assets/js/22.ee117ac9.js"><link rel="prefetch" href="/asm/dist/assets/js/23.c03a1a4d.js"><link rel="prefetch" href="/asm/dist/assets/js/24.7537d8de.js"><link rel="prefetch" href="/asm/dist/assets/js/3.f5310743.js"><link rel="prefetch" href="/asm/dist/assets/js/4.bc7cf726.js"><link rel="prefetch" href="/asm/dist/assets/js/5.d250cb53.js"><link rel="prefetch" href="/asm/dist/assets/js/6.8779df89.js"><link rel="prefetch" href="/asm/dist/assets/js/7.cf8be782.js"><link rel="prefetch" href="/asm/dist/assets/js/8.f2edada3.js"><link rel="prefetch" href="/asm/dist/assets/js/9.fb834f7f.js">
    <link rel="stylesheet" href="/asm/dist/assets/css/0.styles.bcf31e2a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/asm/dist/" class="home-link router-link-active"><!----> <span class="site-name">ASM</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/asm/dist/" class="nav-link">
  主页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/asm/dist/" class="nav-link">
  主页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/asm/dist/AsmSummarize.html" class="sidebar-link">asm教程概述</a></li><li><a href="/asm/dist/visualstudio/" class="sidebar-link">Visual Studio</a></li><li><a href="/asm/dist/cplus/" class="sidebar-link">c++基础</a></li><li><a href="/asm/dist/cplus/cClass.html" class="sidebar-link">C++的类</a></li><li><a href="/asm/dist/cplus/cAdvanced.html" class="sidebar-link">C++ 进阶</a></li><li><a href="/asm/dist/cplus/dll.html" class="sidebar-link">DLL</a></li><li><a href="/asm/dist/cplus/CC.html" class="sidebar-link">C#</a></li><li><a href="/asm/dist/asm/" aria-current="page" class="sidebar-link">asm概述</a></li><li><a href="/asm/dist/asm/basic.html" class="sidebar-link">asm基础</a></li><li><a href="/asm/dist/asm/operator.html" aria-current="page" class="active sidebar-link">asm运算符和指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#mov" class="sidebar-link">mov</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#xchg-交换" class="sidebar-link">xchg 交换</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#偏移操作" class="sidebar-link">偏移操作</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#运算指令和标识符" class="sidebar-link">运算指令和标识符</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#inc-dec" class="sidebar-link">INC DEC</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#add-加指令" class="sidebar-link">ADD 加指令</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#sub-减指令" class="sidebar-link">SUB 减指令</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#mul-乘指令" class="sidebar-link">MUL 乘指令</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#div-除指令" class="sidebar-link">DIV 除指令</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#" class="sidebar-link"></a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#neg-非指令" class="sidebar-link">NEG 非指令</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#offset-地址偏移" class="sidebar-link">offset 地址偏移</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#ptr-重写类型" class="sidebar-link">PTR 重写类型</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#type-元素大小" class="sidebar-link">type 元素大小</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#lengthof-数组个数" class="sidebar-link">lengthof 数组个数</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#jmp跳转" class="sidebar-link">JMP跳转</a></li><li class="sidebar-sub-header"><a href="/asm/dist/asm/operator.html#loop-循环" class="sidebar-link">loop 循环</a></li></ul></li><li><a href="/asm/dist/asm/stack.html" class="sidebar-link">堆栈与函数</a></li><li><a href="/asm/dist/asm/bool.html" class="sidebar-link">汇编条件跳转判断</a></li><li><a href="/asm/dist/asm/function.html" class="sidebar-link">高级函数过程</a></li><li><a href="/asm/dist/asm/float.html" class="sidebar-link">浮点数</a></li><li><a href="/asm/dist/asm/example.html" class="sidebar-link">汇编示例</a></li><li><a href="/asm/dist/ddt/" class="sidebar-link">弹弹堂</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="asm运算符和指令"><a href="#asm运算符和指令" class="header-anchor">#</a> asm运算符和指令</h1> <h2 id="mov"><a href="#mov" class="header-anchor">#</a> mov</h2> <p>mov 赋值指令 从右值赋值与左值
<code>MOV EAX,XXX</code></p> <ol><li>不同寄存器的赋值
下面示例从低位寄存器到高位寄存器</li></ol> <div class="language-asm extra-class"><pre class="language-text"><code>.data
hexFill DWORD 0ffffffffh;

.code
lowerRegister PROC
mov eax,hexFill; //eax为十六进制的ffffffff 占满了8个字节 32位数据
mov ax,0; //设置16位 寄存器的值为0  结果为: eax:ffff0000
ret; //弹出栈顶eax寄存器

lowerRegister ENDP;

END;
</code></pre></div><ol start="2"><li>扩展形式的mov</li></ol> <div class="language-c extra-class"><pre class="language-c"><code>movzx eax<span class="token punctuation">,</span>A69Bh<span class="token punctuation">;</span> <span class="token comment">//全零形式补充 自动补充为0000A69BH </span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code>movsx eax<span class="token punctuation">,</span>A69BH<span class="token punctuation">;</span> <span class="token comment">//有符号形式的扩展 自动补充为FFFFA69BH</span>
</code></pre></div><h2 id="xchg-交换"><a href="#xchg-交换" class="header-anchor">#</a> xchg 交换</h2> <p>用来交换寄存器的值</p> <div class="language-c extra-class"><pre class="language-c"><code>lowerRegister ENDP<span class="token punctuation">;</span>

exchange PROC
mov ebx<span class="token punctuation">,</span><span class="token number">999</span><span class="token punctuation">;</span>
mov eax<span class="token punctuation">,</span><span class="token number">888</span><span class="token punctuation">;</span>
xchg eax<span class="token punctuation">,</span>ebx<span class="token punctuation">;</span> <span class="token comment">//交换eax 和ebx</span>
ret<span class="token punctuation">;</span>
exchange endp<span class="token punctuation">;</span>
</code></pre></div><h2 id="偏移操作"><a href="#偏移操作" class="header-anchor">#</a> 偏移操作</h2> <p>偏移操作通过<code>[地址+偏移]</code> 获取其中的值</p> <p>现在我们定义一个数组来试试</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token punctuation">.</span>data
dwarray DWORD <span class="token number">0F</span>h<span class="token punctuation">,</span><span class="token number">0FF</span><span class="token number">0</span>h<span class="token punctuation">,</span><span class="token number">0FFF</span><span class="token number">000</span>h

<span class="token punctuation">.</span>code
operationOffset PROC
mov eax<span class="token punctuation">,</span><span class="token punctuation">[</span>dwarray<span class="token punctuation">]</span><span class="token punctuation">;</span>
add eax<span class="token punctuation">,</span><span class="token punctuation">[</span>dwarray <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//DWORD占4个字节</span>
add eax<span class="token punctuation">,</span><span class="token punctuation">[</span>dwarray <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
ret<span class="token punctuation">;</span>  <span class="token punctuation">;</span><span class="token comment">//结果为0F+0FF0+0FFF000 = 0FFFFFF =  16,777,215</span>

operationOffset ENDP<span class="token punctuation">;</span>

end<span class="token punctuation">;</span>

</code></pre></div><h2 id="运算指令和标识符"><a href="#运算指令和标识符" class="header-anchor">#</a> 运算指令和标识符</h2> <p>CPU常见的标志位有:</p> <ol><li>运算标志位</li></ol> <ul><li>CF(Carry Flag进位标志位) 1产生进位或错位 反之0</li> <li>PF(Parity Flag 奇偶标志位) 1 为偶数个1 0 为 奇数个1</li> <li>AF(Auxiliary Flag 辅助进位标志位) 最后4位有前进位1 反之0</li> <li>ZF(zero flag 零标志位) 结果有0 为1 反之0</li> <li>SF(Sing flag 符号标志位) 整数0 负数1</li> <li>0F(overflow flag 溢出标志位) 加减法得出结果溢出为 1 反之0</li></ul> <ol start="2"><li>状态标志位</li></ol> <ul><li>TF(追踪标志位)</li> <li>IF(中断标志位)</li> <li>DF(方向标志位)</li></ul> <p>Visual Studio 汇编标志位有点不同:</p> <div class="language-c extra-class"><pre class="language-c"><code>OV  <span class="token operator">=</span> OF
UP <span class="token operator">=</span> DF 
EI <span class="token operator">=</span> IF
PL <span class="token operator">=</span> SF
ZR <span class="token operator">=</span> ZF
AC <span class="token operator">=</span> AF
PE <span class="token operator">=</span> PF 
CY <span class="token operator">=</span> CF
</code></pre></div><h2 id="inc-dec"><a href="#inc-dec" class="header-anchor">#</a> INC DEC</h2> <p>先看看最简单的</p> <div class="language-c extra-class"><pre class="language-c"><code>inc 自增
dec 自减
</code></pre></div><p>下面代码会自增自减并返回</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token punctuation">.</span>data
tmp DWORD <span class="token number">10</span>h<span class="token punctuation">;</span>

<span class="token punctuation">.</span>code

incAndDec PROC
inc tmp<span class="token punctuation">;</span> <span class="token comment">//11H</span>
mov eax<span class="token punctuation">,</span>tmp<span class="token punctuation">;</span> 
dec eax<span class="token punctuation">;</span>  <span class="token comment">//10H</span>
ret<span class="token punctuation">;</span>
incAndDec ENDP<span class="token punctuation">;</span>

end<span class="token punctuation">;</span>
</code></pre></div><p>当我们执行完
<code>inc tmp</code> 从 <code>00000010</code> 到 <code>00000011</code>
奇偶标志位应为1<code>PF(parity flag) = 1</code></p> <p>在执行完
<code>dec eax</code>
```(PF)``标志位应为0</p> <h2 id="add-加指令"><a href="#add-加指令" class="header-anchor">#</a> ADD 加指令</h2> <p>我们在看看add指令:</p> <div class="language-c extra-class"><pre class="language-c"><code>addFlag PROC
mov eax<span class="token punctuation">,</span><span class="token number">0ff</span>h<span class="token punctuation">;</span>
add eax<span class="token punctuation">,</span><span class="token number">1</span>h<span class="token punctuation">;</span>
ret<span class="token punctuation">;</span>
addFlag ENDP
</code></pre></div><ul><li>执行到<code>mov eax,0ffh;</code> 那么0xff = 1111 1111 偶数位的1 PF=1</li> <li>执行到<code>add eax,1h;</code> 那么就从 1111 1111 到了 1 0000 0000 有进位那么AF=1</li></ul> <h2 id="sub-减指令"><a href="#sub-减指令" class="header-anchor">#</a> SUB 减指令</h2> <div class="language-c extra-class"><pre class="language-c"><code>subFlag PROC
mov eax<span class="token punctuation">,</span><span class="token number">011</span>b<span class="token punctuation">;</span>
sub eax<span class="token punctuation">,</span><span class="token number">1</span>b<span class="token punctuation">;</span>
ret<span class="token punctuation">;</span>
subFlag ENDP
</code></pre></div><h2 id="mul-乘指令"><a href="#mul-乘指令" class="header-anchor">#</a> MUL 乘指令</h2> <div class="language-c extra-class"><pre class="language-c"><code>mov eax<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span>
mov ebx<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">;</span>
mul eax<span class="token punctuation">,</span>ebx<span class="token punctuation">;</span>
</code></pre></div><h2 id="div-除指令"><a href="#div-除指令" class="header-anchor">#</a> DIV 除指令</h2> <div class="language-c extra-class"><pre class="language-c"><code>mov eax<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">;</span>
mov ebx<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span>
div eax<span class="token punctuation">,</span>ebx<span class="token punctuation">;</span>
</code></pre></div><h2 id=""><a href="#" class="header-anchor">#</a></h2> <ul><li>执行到 <code>mov eax,0b</code> PF = 0</li> <li>执行到 <code>sub eax,1b</code> EAX = FFFFFFFF 那么 SF = 1(sing flag 符号变负数)
AF = (auxiliary flag 后4位进位) PF(parity 偶数) = 1 CF(进位) = 1</li></ul> <h2 id="neg-非指令"><a href="#neg-非指令" class="header-anchor">#</a> NEG 非指令</h2> <p>非指令 获得一个数的补码也就是该数的负数</p> <blockquote><p>取反 + 1 是一个数的补码 也是一个数的反数 用来加上一个数的负数 = 0</p></blockquote> <div class="language-c extra-class"><pre class="language-c"><code>negFlag PROC
mov eax<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span>
neg eax<span class="token punctuation">;</span>
ret<span class="token punctuation">;</span>
negFlag endp<span class="token punctuation">;</span>
</code></pre></div><ul><li>执行到 neg eax; eax = FFFFFFFF 那么 SF(负数) = 1 AF(辅助进位) = 1 CF(进位) = 1</li></ul> <h2 id="offset-地址偏移"><a href="#offset-地址偏移" class="header-anchor">#</a> offset 地址偏移</h2> <p>offset用来获取一个数句标号的起始地址</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token punctuation">.</span>data
darray DWORD <span class="token number">0F</span>h<span class="token punctuation">,</span><span class="token number">0FF</span>h<span class="token punctuation">,</span><span class="token number">0FFF</span>h<span class="token punctuation">,</span><span class="token number">0FFF</span>h<span class="token punctuation">;</span>

<span class="token punctuation">.</span>code 
offsetOp PROC
mov rsi<span class="token punctuation">,</span>OFFSET darray<span class="token punctuation">;</span>
mov rdi<span class="token punctuation">,</span>rsi<span class="token punctuation">;</span>
add rdi<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">;</span>
add rdi<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">;</span>
mov eax<span class="token punctuation">,</span><span class="token punctuation">[</span>rdi<span class="token punctuation">]</span><span class="token punctuation">;</span>
ret<span class="token punctuation">;</span>
offsetOp endp<span class="token punctuation">;</span>
</code></pre></div><p>上面做了如下操作:</p> <ul><li><code>mov rsi,OFFSET darray</code> 复制给rsi darray数据地址</li> <li><code>mov rdi,rsi</code> 转给edi准备变换源地址</li> <li><code>add rdi,4; add rdi,8;</code> rdi+12 跳到 darray最后一个 (dword占4字节)</li> <li><code>mov eax,[rdi]</code> 间接寻址rdi地址的值</li></ul> <h2 id="ptr-重写类型"><a href="#ptr-重写类型" class="header-anchor">#</a> PTR 重写类型</h2> <p>ptr 重写操作数数据类型</p> <p>以上一个例子来说,当我们想把一个高位数存在低位数的寄存器中:</p> <div class="language-c extra-class"><pre class="language-c"><code>ptrOp PROC
mov rsi<span class="token punctuation">,</span>OFFSET darray<span class="token punctuation">;</span>
mov rdi<span class="token punctuation">,</span>rsi<span class="token punctuation">;</span>
add rdi<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">;</span>
mov rax<span class="token punctuation">,</span>QWORD ptr<span class="token punctuation">[</span>rdi<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//注意这里eax 改成rax,且类型数据转换为QWORD</span>
ret<span class="token punctuation">;</span>
ptrOp endp<span class="token punctuation">;</span>
</code></pre></div><h2 id="type-元素大小"><a href="#type-元素大小" class="header-anchor">#</a> type 元素大小</h2> <div class="language-c extra-class"><pre class="language-c"><code>typeOp PROC
mov rsi<span class="token punctuation">,</span>OFFSET darray<span class="token punctuation">;</span>
mov eax<span class="token punctuation">,</span>type rsi<span class="token punctuation">;</span>
ret<span class="token punctuation">;</span> <span class="token comment">//得到的是8个字节</span>
typeOp endp<span class="token punctuation">;</span> 
</code></pre></div><h2 id="lengthof-数组个数"><a href="#lengthof-数组个数" class="header-anchor">#</a> lengthof 数组个数</h2> <div class="language-c extra-class"><pre class="language-c"><code>lengthofOp proc
mov eax<span class="token punctuation">,</span>lengthof darray<span class="token punctuation">;</span>
ret<span class="token punctuation">;</span>
lengthofOp endp<span class="token punctuation">;</span>
</code></pre></div><h2 id="jmp跳转"><a href="#jmp跳转" class="header-anchor">#</a> JMP跳转</h2> <div class="language-c extra-class"><pre class="language-c"><code>jumOp proc
jmp lengthofOp<span class="token punctuation">;</span> <span class="token comment">//直接跳到之前的操作</span>
jumOp endp<span class="token punctuation">;</span>
</code></pre></div><h2 id="loop-循环"><a href="#loop-循环" class="header-anchor">#</a> loop 循环</h2> <p>也被称为ecx 计数循环</p> <div class="language-c extra-class"><pre class="language-c"><code>loopOp proc
mov eax<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span>
mov ecx<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">;</span>

L1<span class="token operator">:</span>
  inc eax<span class="token punctuation">;</span>
  loop L1<span class="token punctuation">;</span> <span class="token comment">//计数循环ecx5次</span>

ret<span class="token punctuation">;</span> <span class="token comment">//eax结果为5</span>
loopOp endp<span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/4/2022, 10:46:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/asm/dist/asm/basic.html" class="prev">
        asm基础
      </a></span> <span class="next"><a href="/asm/dist/asm/stack.html">
        堆栈与函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/asm/dist/assets/js/app.6634fcdc.js" defer></script><script src="/asm/dist/assets/js/2.c8a9966a.js" defer></script><script src="/asm/dist/assets/js/15.55afd9f3.js" defer></script>
  </body>
</html>
